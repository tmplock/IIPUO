<br><br><br>

<div class="container">
    <!--서브페이지들-->
    <div class="sub-wrap">
        <!--입금신청-->
        <div class="subscr">
            <div class="subtitle">
                <h1>회원가입</h1>
                <!-- <span>신속한 충전을 위해서 올바른 입금정보를 입력해 주셔야 합니다. 입금확인 즉시 게임머니를 충전해 드립니다.</span> -->
            </div>
            <div id = 'input'>
                <table>
                    <colgroup>
                        <col style="width:24%;">
                        <col style="width:40%;">
                        <col style="width:30%;">
                    </colgroup>
                    <tr>
                        <td>아이디</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterID" type="text" value=""/>
                            <button style="width:30%;" onclick="RequestCheckID();">아이디 확인</button>
                        </td>
                        <td>                            
                            <p style="color: red; font-size: 15px;">* 필수 입력 사항입니다.</p>
                        </td>
                    </tr>
                    <tr>
                        <td>닉네임</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterNickname" type="text" value=""/>
                            <button style="width:30%;" onclick="RequestCheckNickname();">닉네임 확인</button>
                        </td>
                        <td>                            
                            <p style="color: red; font-size: 15px;">* 필수 입력 사항입니다.</p>
                        </td>
                    </tr>
                    <tr>
                        <td>비밀번호</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterPassword" type="password" value=""/>
                        </td>
                        <td>                            
                            <p style="color: red; font-size: 15px;">* 필수 입력 사항입니다.</p>
                        </td>
                    </tr>
                    <tr>
                        <td>비밀번호 확인</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterPasswordConfirm" type="password" value=""/>
                        </td>
                        <td>                            
                            <p style="color: red; font-size: 15px;">* 필수 입력 사항입니다.</p>
                        </td>
                    </tr>

                    <tr>
                        <td>은행명</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterBankName" type="text" value=""/>
                        </td>
                        <td>                            
                            <p style="color: red; font-size: 15px;">* 필수 입력 사항입니다.</p>
                        </td>
                    </tr>
                    <tr>
                        <td>계좌번호</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterBankAccount" type="text" value=""/>
                        </td>
                        <td>                            
                            <p style="color: red; font-size: 15px;">* 필수 입력 사항입니다.</p>
                        </td>
                    </tr>
                    <tr>
                        <td>예금주</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterBankAccountHolder" type="text" value=""/>
                        </td>
                        <td>                            
                            <p style="color: red; font-size: 15px;">* 필수 입력 사항입니다.</p>
                        </td>
                    </tr>
                    <tr>
                        <td>연락처</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterMobile" type="text" value=""/>
                        </td>
                        <td>                            
                        </td>
                    </tr>

                    <tr>
                        <td>추천인 아이디</td>
                        <td style="padding: 15px 0">
                            
                            <input name="strRegisterRecommender" type="text" value=""/>
                        </td>
                        <td>                            
                            <p style="color: greenyellow; font-size: 15px;">* 추천인이 없을 경우 빈칸으로 둡니다.</p>
                        </td>
                    </tr>






                </table>
            </div>

            <div class="text-info-01">
                * 아이디와 닉네임은 고유해야 하므로 사용 가능한 아이디인지 확인을 하고 가입 하시기 바랍니다. <br>
                * 은행명과 계좌번호, 예금주는 출금시 사용되므로 반드시 올바르게 입력 해야 합니다.<br>
            </div>
            <div class="btn_area_one" id="button">
                <button id="btn_submit" type="button" onclick="OnClickRegister();">회원 가입</button>
            </div>
        </div>
    </div>
</div>

<script>

    let bCheckID = false;
    let bCheckNickname = false;
    let bEnableCheck = true;
    let iEnableCheckTime = 0;

    let OnClickRegister = () => {

        let objectData = {
            strRegisterID:$('input[name=strRegisterID]').val(),
            strRegisterNickname:$('input[name=strRegisterNickname]').val(),
            strRegisterPassword:$('input[name=strRegisterPassword]').val(),
            strRegisterPasswordConfirm:$('input[name=strRegisterPasswordConfirm]').val(),
            strRegisterBankName:$('input[name=strRegisterBankName]').val(),
            strRegisterBankAccount:$('input[name=strRegisterBankAccount]').val(),
            strRegisterBankAccountHolder:$('input[name=strRegisterBankAccountHolder]').val(),
            strRegisterMobile:$('input[name=strRegisterMobile]').val(),
            strRegisterRecommender:$('input[name=strRegisterRecommender]').val(),
        }

        // console.log(objectData);
        // return;

        console.log(objectData);

        if ( bCheckID == false )
        {
            alert('아이디 확인이 필요 합니다.');
            return;
        }
        if ( bCheckNickname == false )
        {
            alert('닉네임 확인이 필요 합니다.');
            return;
        }
        if ( objectData.strRegisterID == '' || objectData.strRegisterNickname == '' || objectData.strRegisterBankName == '' || objectData.strRegisterBankAccount == '' || objectData.strRegisterBankAccountHolder == '' || objectData.strRegisterPassword == '' )
        {
            alert('필수 입력 사항을 모두 입력 하십시오.');
            return;
        }
        if ( objectData.strRegisterPassword != objectData.strRegisterPasswordConfirm )
        {
            alert('비밀번호와 비밀번호 확인이 틀립니다.');
            return;
        }

        $.ajax({
            type:'post',
            url: "/account/request_register",
            context: document.body,
            data:objectData,
    
            success:function(data) {

                if ( data.result == 'OK' ){
                    alert(`회원 가입이 완료 되었습니다.`);
                    location.href = '/';
                }
                else
                {
                    if ( data.result == 'Error' && data.eCode == 'InvalidParent')
                    {
                        alert('추천인 아이디가 올바르지 않습니다.');
                    }
                    else
                    {
                        alert('회원 가입에 실패 하였습니다.');
                    }
                }                    
            },
            error:function() {
                console.log('error');
            }
        });
    }

    let RequestCheckID = () => {

        if ( iEnableCheckTime != 0 )
        {
            return;
        }

        const strRegisterID = $('input[name=strRegisterID]').val();

        if ( strRegisterID.length <= 0 )
        {
            return;
        }

        console.log(`RequestCheckID : ${strRegisterID}`);



        let token = /[\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/g;

        if ( token.test(strRegisterID) == true )
        {
            bCheckID = false;
            alert('특수문자는 사용 할 수 없습니다.');
            return;
        }
        if ( strRegisterID.length > 12 )
        {
            bCheckID = false;
            alert('아이디의 길이는 12자 이하로 생성 가능 합니다.')
        }

        iEnableCheckTime = 3;

        $.ajax({
            type:'post',
            url: "/account/request_checkid",
            data:{strID:strRegisterID},
            success: (obj) => {
                if (obj.result == 'OK') 
                {
                    alert('사용 가능한 아이디 입니다.');
                    bCheckID = true;
                } 
                else
                {
                    alert('사용할 수 없는 아이디 입니다.');
                    bCheckID = false;
                }
            },
            error:function(request,status,error){
                alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
            }
        });
    }

    let RequestCheckNickname = () => {

        if ( iEnableCheckTime != 0 )
        {
            return;
        }

        const strRegisterNickname = $('input[name=strRegisterNickname]').val();

        console.log(`RequestCheckNickname : ${strRegisterNickname}`);

        if ( strRegisterNickname.length <= 0 )
        {
            return;
        }

        let token = /[\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/g;

        if ( token.test(strRegisterNickname) == true )
        {
            bCheckNickname = false;
            alert('특수문자는 사용 할 수 없습니다.');
            return;
        }
        if ( strRegisterNickname.length > 12 )
        {
            bCheckNickname = false;
            alert('아이디의 길이는 12자 이하로 생성 가능 합니다.')
        }

        iEnableCheckTime = 3;

        $.ajax({
            type:'post',
            url: "/account/request_checknickname",
            data:{strNickname:strRegisterNickname},
            success: (obj) => {
                if (obj.result == 'OK') 
                {
                    alert('사용 가능한 닉네임 입니다.');
                    bCheckNickname = true;
                } 
                else
                {
                    alert('사용할 수 없는 닉네임 입니다.');
                    bCheckNickname = false;
                }
            },
            error:function(request,status,error){
                alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
            }
        });
    }

    setInterval( () => {
        if ( iEnableCheckTime > 0 )
        {
            iEnableCheckTime --;
            console.log(iEnableCheckTime);
        }
    }, 1000);

</script>