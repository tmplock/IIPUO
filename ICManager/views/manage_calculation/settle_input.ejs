<div class="sub_wrap">
    <div class="container clearfix">
        <div class="content" style="position:relative; padding:0 10px 0 10px;">
			<ul class="list_tab" style="margin-bottom:10px;width:75%;z-index:10000;" id="calculation_header">
			</ul>
        </div>

        <div class="list">
			<div id = "list_tit" class="list_tit">
			</div>

			<div class="search_wrap" id="div_realtimebet">
	
				<table class="search_list">
					<caption><%=__('SearchResult')%></caption>
					<thead>
						<tr>
							<th scope="col">대본사</th>
							<th scope="col">부본사</th>
							<th scope="col" style="background-color:#78bfdb;color:white;">바카라 베팅</th>
							<th scope="col" style="background-color:#78bfdb;color:white;">바카라 승리</th>
							<th scope="col" style="background-color:#78bfdb;color:white;">언오버 베팅</th>
							<th scope="col" style="background-color:#78bfdb;color:white;">언오버 승리</th>
							<th scope="col" style="background-color:#78bfdb;color:white;">슬롯 베팅</th>
							<th scope="col" style="background-color:#78bfdb;color:white;">슬롯 승리</th>
						</tr>
					</thead>
					<tbody id="list_agents">
					</tbody>
				</table>

				<div class="pagination mt0" id="pagination">
				</div>
			</div>
		</div>
        </div>
    </div>
</div>
<script type="text/javascript" src="js/constants.js"></script>
<script type="text/javascript" src="js/enum.js"></script>
<script type="text/javascript" src="js/time.js"></script>
<script type="text/javascript" src="js/manage_calculation_menu.js"></script>
<script type="text/javascript" src="js/manage_setting_ref.js"></script>
<script type="text/javascript" src="js/manage_user_menu.js"></script>
<script type="text/javascript" src="js/pagination.js"></script>
<script type="text/javascript" src="js/util.js"></script>
<script>
	let user = JSON.parse('<%-JSON.stringify(user)%>');
	let vadminList = JSON.parse('<%-JSON.stringify(list)%>');

	let bEnableSettle = false;
	let bSending = false;

	$(document).ready(() => {
		$('#button_settle_cal').hide();
		if ( user.iClass > 3 )
			$('#button_settle_cal').hide();
		SetList(vadminList);
	});

	let SetList = (list) => {
		$('#list_agents').empty();

		$(`#main_title`).empty();
		$(`#main_title`).append(`
					<h3>
						<a class="btn_gray" style="font-weight:bold; font-size:18px; position:absolute; left:50px; top:25px;">죽장 데이터 입력</a>
					</h3>
				`);

		$(`#list_tit`).empty();
		$(`#list_tit`).append(`
							<h3>
								<button id='button_calulationsettle' style="margin-left:8%;width:200px;height:40px;text-align:center;background-color: rgb(82, 161, 206);color:white" onclick="OnClickApplySettleInput();"><strong>입력 적용</strong></button>
							</h3>
						`);

		for (let i in list) {
			let obj = list[i];
			let tag = AddPartner(5, obj);
			$('#list_agents').append(tag);
		}
	}

	let AddPartner = (iRootClass, aObject) => {
		let color = '#ffffff';

		var subtag = ``;
		// 본사
		subtag += `<tr><td>${aObject.strNickname4 ?? ''}</td>`;
		// 대본
		subtag += `<tr><td>${aObject.strNickname4 ?? ''}</td>`;
		subtag += `
				<td style="background-color:${color};"  class="parent_row_31">
					<a href="#" onclick="OnClickNickname('${aObject.strNickname}')" style="color:blue;">${aObject.strNickname}</a>
				</td>
		`;

		// 바카라 베팅
		subtag += `
				<td style="background-color:${color};" class="parent_row_31">
					<input type="number" style='width:80%;height:20px;text-align:center;color:black;' value='${aObject.iAgentBetB}' id='input_b_${aObject.strNickname}'/>
				</td>`;
		subtag += `
				<td style="background-color:${color};" class="parent_row_31">
					<input type="number" style='width:80%;height:20px;text-align:center;color:black;' value='${aObject.iAgentWinB}' id='input_bwin_${aObject.strNickname}'/>
				</td>`;
		//언오버
		subtag += `
				<td style="background-color:${color};" class="parent_row_31">
					<input type="number" style='width:80%;height:20px;text-align:center;color:black;' value='${aObject.iAgentBetUO}' id='input_uo_${aObject.strNickname}'/>
				</td>`;
		subtag += `
				<td style="background-color:${color};" class="parent_row_31">
					<input type="number" style='width:80%;height:20px;text-align:center;color:black;' value='${aObject.iAgentWinUO}' id='input_uowin_${aObject.strNickname}'/>
				</td>`;
		// 슬롯
		subtag += `
				<td style="background-color:${color};" class="parent_row_31">
					<input type="number" style='width:80%;height:20px;text-align:center;color:black;' value='${aObject.iAgentBetS}' id='input_s_${aObject.strNickname}'/>
				</td>`;
		subtag += `
				<td style="background-color:${color};" class="parent_row_31">
					<input type="number" style='width:80%;height:20px;text-align:center;color:black;' value='${aObject.iAgentWinS}' id='input_wins_${aObject.strNickname}'/>
				</td>`;

		subtag += `</tr>`;
		return subtag;
	}

	let OnClickApplySettleInput = () => {
		if (bSending) {
			alert('처리중입니다.');
			return;
		}
		bSending = true;

		let ok = confirm('입력 내용을 적용 하시겠습니까?');
		if (ok != true) {
			bSending = false;
			return;
		}

		console.log('OnClickApplySettleInput');

		let list = [];
		for (let i in settleList) {
			list.push(settleList[i].strNickname);
			list.push(settleList[i].strID);
			list.push(settleList[i].fSettleBaccarat4 ?? 0);
			list.push(settleList[i].fSettleSlot4 ?? 0);
			let winloseB = settleList[i].iBaccaratWinLose ?? 0;
			let winloseUO = settleList[i].iUnderOverWinLose ?? 0;
			if (winloseB + winloseUO < 0) {
				list.push(0);
				list.push(0);
			} else {
				list.push(winloseB);
				list.push(winloseUO);
			}
			let winloseSlot = settleList[i].iSlotWinLose ?? 0;
			if (winloseSlot < 0) {
				list.push(0);
			} else {
				list.push(winloseSlot);
			}
			list.push(settleList[i].iCommissionBaccarat ?? 0);
			list.push(settleList[i].iCommissionSlot ?? 0);
			list.push(settleList[i].iSettle ?? 0);
			list.push(settleList[i].iTotal4 ?? 0);
		}

		let data = list.join(',');
		console.log(data);

		$.ajax({
			url:'/manage_calculation_settle/request_settle_input',
			type:"POST",
			data:{
				data:data,
			},
			dataType: "json",
			success: function (obj) {
				bSending = false;

				console.log(obj);
				if ( obj.result == 'OK')
				{
					alert('적용이 완료 되었습니다.');
					opener.location.reload();
				}
				else
				{
					alert(obj.msg);
				}
			}
		});


	}
</script>
